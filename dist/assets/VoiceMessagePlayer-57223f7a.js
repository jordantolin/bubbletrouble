import{c as S,r as o,R as l,P as C,a as F}from"./index-cd46e9a9.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I=[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]],_=S("cloud-upload",I);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const j=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],B=S("triangle-alert",j),W=e=>Math.pow(2,Math.ceil(Math.log2(e))),H=(e,f,a=24)=>{var p;const[w,y]=o.useState(Array(a).fill(0)),u=o.useRef(null),t=o.useRef(null),s=o.useRef(null),r=o.useRef(null),c=o.useRef(null);return o.useEffect(()=>{if(f&&e.current&&e.current.readyState>=1){u.current||(u.current=new(window.AudioContext||window.webkitAudioContext),t.current=u.current.createAnalyser(),t.current.fftSize=W(Math.max(32,a*2)),s.current=u.current.createMediaElementSource(e.current),s.current.connect(t.current),r.current=new Uint8Array(t.current.frequencyBinCount));const h=()=>{if(t.current&&r.current){t.current.getByteFrequencyData(r.current);const i=[],m=Math.floor(r.current.length/a);for(let x=0;x<a;x++){let g=0;for(let E=0;E<m;E++)g+=r.current[x*m+E];const v=g/m;i.push(v)}y(i)}c.current=requestAnimationFrame(h)};h()}else c.current&&cancelAnimationFrame(c.current),y(Array(a).fill(0));return()=>{c.current&&cancelAnimationFrame(c.current)}},[f,e,a]),o.useEffect(()=>{const h=u.current,i=s.current,m=t.current;return()=>{i&&i.disconnect(),m&&m.disconnect(),h&&h.state!=="closed"&&h.close().catch(console.error)}},[]),{heights:w,analyserRef:t.current,bufferLength:(p=t.current)==null?void 0:p.frequencyBinCount}},P=e=>{const f=Math.floor(e/60),a=Math.floor(e%60);return`${String(f).padStart(2,"0")}:${String(a).padStart(2,"0")}`},O=({src:e,duration:f=0,isPlaying:a,onPlay:w,onPause:y,onEnded:u,isCurrentUser:t,status:s})=>{const r=o.useRef(null),[c,p]=o.useState(!1),[h,i]=o.useState(null),[m,x]=o.useState(0),{heights:g,analyserRef:v,bufferLength:E}=H(r,a&&!!e&&s!=="failed",24);o.useEffect(()=>{r.current&&e?r.current.src!==e&&(r.current.src=e,r.current.load(),p(!1),i(null)):!e&&r.current&&(r.current.removeAttribute("src"),p(!1),i(null))},[e]),o.useEffect(()=>{const n=r.current;if(!n)return;const d=()=>p(!0),M=()=>{u&&u(),i(null)},R=z=>{console.error("Audio Error:",z),i("Errore caricamento audio."),p(!1)},N=()=>x(n.currentTime);return n.addEventListener("loadedmetadata",d),n.addEventListener("ended",M),n.addEventListener("error",R),n.addEventListener("timeupdate",N),()=>{n.removeEventListener("loadedmetadata",d),n.removeEventListener("ended",M),n.removeEventListener("error",R),n.removeEventListener("timeupdate",N)}},[u]),o.useEffect(()=>{const n=r.current;n&&c&&(a?n.play().catch(d=>{d.name!=="AbortError"&&(console.warn("Chat Play error:",d),i("Impossibile riprodurre."))}):n.paused||n.pause())},[a,c]);const $=()=>{!c||!e||s==="failed"||(a?y&&y():w&&w())},k=f>0?m/f*100:0,A=t?"bg-yellow-400":"bg-white",b=t?"text-white":"text-gray-800",L=t?"text-yellow-100":"text-yellow-600",T=t?"bg-yellow-200/60":"bg-yellow-400/80",q=t?"bg-yellow-500/50":"bg-yellow-300/50";return s==="failed"?l.createElement("div",{className:`flex items-center gap-2 p-2 rounded-lg ${A} ${b} opacity-70`},l.createElement(B,{size:20,className:"text-red-500"}),l.createElement("span",{className:"text-xs"},"Invio fallito")):l.createElement("div",{className:`flex items-center gap-2 p-2.5 rounded-xl shadow-sm w-full ${A} ${t?"":"border border-gray-200"}`,style:{minWidth:"180px",maxWidth:"280px"}},l.createElement("button",{onClick:$,disabled:!c||!e||s==="uploading",className:`p-1.5 rounded-full ${L} hover:bg-black/10 transition-colors disabled:opacity-50 flex-shrink-0`},s==="uploading"?l.createElement(_,{size:18,className:"animate-pulse"}):a?l.createElement(C,{size:18}):l.createElement(F,{size:18})),l.createElement("div",{className:"flex-grow h-8 flex items-center gap-px relative overflow-hidden mx-1"},e&&c&&l.createElement("div",{className:`absolute top-0 left-0 h-full ${q} rounded`,style:{width:`${k}%`}}),Array.from({length:E||24}).map((n,d)=>l.createElement("div",{key:d,className:`${T} rounded-sm transition-all duration-50`,style:{width:"2.5px",height:`${a&&g[d]?Math.max(2,g[d]/255*100*.28):s==="uploading"?2+Math.random()*4:2}px`,marginRight:"1px"}}))),e&&c&&l.createElement("span",{className:`text-xs font-medium ${b} opacity-80 min-w-[35px] text-right`},P(f||0)),!e&&s!=="uploading"&&l.createElement("span",{className:"text-xs text-gray-400"},"Audio non disp."),l.createElement("audio",{ref:r,className:"hidden",onEnded:u}))};export{O as default};
